<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Operators and Indexes &mdash; GreenplumPython 1.1.0
 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Embedding" href="embedding.html" />
    <link rel="prev" title="Ordering" href="order.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> GreenplumPython
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="req.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="req_advanced.html">Requirements on Server for Advanced Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">Module References</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="db.html">Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="dataframe.html">DataFrame</a></li>
<li class="toctree-l2"><a class="reference internal" href="expr.html">Expression</a></li>
<li class="toctree-l2"><a class="reference internal" href="col.html">Column</a></li>
<li class="toctree-l2"><a class="reference internal" href="row.html">Row</a></li>
<li class="toctree-l2"><a class="reference internal" href="func.html">Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="builtins.html">Builtins Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="type.html">Type</a></li>
<li class="toctree-l2"><a class="reference internal" href="group.html">Grouping</a></li>
<li class="toctree-l2"><a class="reference internal" href="order.html">Ordering</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Operators and Indexes</a></li>
<li class="toctree-l2"><a class="reference internal" href="embedding.html">Embedding</a></li>
<li class="toctree-l2"><a class="reference internal" href="pd_df.html">Pandas-Compatible DataFrame</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html">Configuration</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GreenplumPython</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="modules.html">Module References</a> &raquo;</li>
      <li>Operators and Indexes</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/greenplum-db/GreenplumPython/blob/main/doc/source/op.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="operators-and-indexes">
<h1>Operators and Indexes<a class="headerlink" href="#operators-and-indexes" title="Permalink to this heading"></a></h1>
<p>module:: greenplumpython</p>
<span class="target" id="module-op"></span><p>Indexes are essential for fast data searching.</p>
<p>With indexes, we can retrieve rows we want by scanning the index, rather than
the entire dataframe. As a result, when the dataframe is large, the amount of
data to be scanned is typically much smaller with an index.</p>
<p>In pandas, a <code class="code docutils literal notranslate"><span class="pre">DataFrame</span></code> or <code class="code docutils literal notranslate"><span class="pre">Series</span></code> can have only one index. This
means that we can do index scan based on one column. While for other columns,
we will have to go through all rows. This can be rather inefficient.</p>
<p>Backed by database systems, GreenplumPython overcomes this limitation by
allowing the creation of</p>
<ul class="simple">
<li><p>multiple indexes, each for one set of columns, and</p></li>
<li><p>multiple types of indexes for same set of columns, each for one order.</p></li>
</ul>
<p>In this way, we can search a GreenplumPython’s dataframe with index scan, on
more than one column set in more than one order.</p>
<p>For example, a dataframe containing AI-generated embeddings may contain</p>
<ul class="simple">
<li><p>a column of IDs and</p></li>
<li><p>a column of vectors.</p></li>
</ul>
<p>We can search for embeddings by either IDs or vectors using index scan after
creating an index on the ID column and another index on the vector column.</p>
<p>As another example, suppose we want to search for Approximate Nearest Neighbors
for a given vector based on not only cosine similarity, but also L_2
distance. We can create two indexes on the vector column, each for one
similarity metric.</p>
<p>How to search a dataframe with index is defined by a set of operators on the
indexed columns. For example, when scanning a B-tree index, relational
operators, such as <code class="code docutils literal notranslate"><span class="pre">&gt;</span></code>, <code class="code docutils literal notranslate"><span class="pre">&lt;</span></code>, and <code class="code docutils literal notranslate"><span class="pre">=</span></code>, are required for
comparing two values. These operators are encapsulated as an <a class="reference external" href="https://www.postgresql.org/docs/current/indexes-opclass.html">operator class</a>.
Different data types have different operator classes for an index. For example,
integers and floats are compared in different ways. Even for the same data type,
we can change how two values are compared by changing the operator class.</p>
<p>Since indexes depend on operators to work, to use index scan, we need to specify
the filering predicate in the <code class="code docutils literal notranslate"><span class="pre">[]</span></code> operator and <code class="xref py py-meth docutils literal notranslate"><span class="pre">where()</span></code>
with operators when doing comparison or computing similarity. To ease the use of
operators in database,</p>
<ul class="simple">
<li><p>for Python’s built-in operators, we map it to the database operators of the
same name, and</p></li>
<li><p>for others that do not have a built-in equivalence, we can use the
<a class="reference internal" href="#op.operator" title="op.operator"><code class="xref py py-func docutils literal notranslate"><span class="pre">operator()</span></code></a> function to map a database operator to a Python
<code class="xref py py-class docutils literal notranslate"><span class="pre">Callable</span></code>. Calling the Python function will apply the operator.</p></li>
</ul>
<dl class="py class">
<dt class="sig sig-object py" id="op.Operator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">op.</span></span><span class="sig-name descname"><span class="pre">Operator</span></span><a class="headerlink" href="#op.Operator" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Represents an operator in database.</p>
<p>As a Python object, an <a class="reference internal" href="#op.Operator" title="op.Operator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Operator</span></code></a> can be called like a function.
This is because unlike SQL, Python does not support defining new operators.</p>
<p>When an <a class="reference internal" href="#op.Operator" title="op.Operator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Operator</span></code></a> is called, the corresponding operator in database
will be applied.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="op.operator">
<span class="sig-prename descclassname"><span class="pre">op.</span></span><span class="sig-name descname"><span class="pre">operator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#op.operator" title="Permalink to this definition"></a></dt>
<dd><p>Get access to a predefined <a class="reference internal" href="#op.Operator" title="op.Operator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Operator</span></code></a> in database.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<em>str</em>) – Name of the operator.</p></li>
<li><p><strong>schema</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em>) – Schema (a.k.a. namespace) of the operator in database.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference internal" href="#op.Operator" title="op.Operator"><em>Operator</em></a></p>
</dd>
</dl>
<dl class="simple">
<dt>Returns</dt><dd><p>An <a class="reference internal" href="#op.Operator" title="op.Operator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Operator</span></code></a> that is <code class="xref py py-class docutils literal notranslate"><span class="pre">Callable</span></code>. When the
<a class="reference internal" href="#op.Operator" title="op.Operator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Operator</span></code></a> is called, the corresponding database operator will
be applied.</p>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="order.html" class="btn btn-neutral float-left" title="Ordering" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="embedding.html" class="btn btn-neutral float-right" title="Embedding" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, VMware.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
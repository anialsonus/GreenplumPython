<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>&lt;no title&gt; &mdash; GreenplumPython 1.0.0-beta2 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Data Science on Python with GreenplumPython" href="../examples.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> GreenplumPython
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">GreenplumPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Data Science on Python with GreenplumPython</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GreenplumPython</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../examples.html">Data Science on Python with GreenplumPython</a> &raquo;</li>
      <li>&lt;no title&gt;</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/greenplum-db/GreenplumPython/blob/main/doc/source/notebooks/GreenplumPython-abalone.ipynb" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<dl>
<dt>{</dt><dd><dl>
<dt>“cells”: [</dt><dd><dl>
<dt>{</dt><dd><p>“cell_type”: “markdown”,
“metadata”: {</p>
<blockquote>
<div><p>“collapsed”: true</p>
</div></blockquote>
<p>},
“source”: [</p>
<blockquote>
<div><p>“# Contextn”,
“<strong>Background:</strong>n”,
“n”,
“Predicting the age of abalone from physical measurements.  The age of abalone is determined by cutting the shell through the cone, staining it, and counting the number of rings through a microscope – a boring and time-consuming task.  Other measurements, which are easier to obtain, are used to predict the age.n”,
“n”,
“<strong>Problem:</strong>n”,
“n”,
“Build regression models by ‘sex’ which can predict ‘the number of rings’.”</p>
</div></blockquote>
<p>]</p>
</dd>
</dl>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“<strong>Fetch data from ML data repository:</strong>n”,
“n”,
“We can fetch data to Greenplum Using following steps.”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 1,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“%load_ext sqln”,
“%sql postgresql://gpadmin:<a href="#id1"><span class="problematic" id="id2">**</span></a><a href="#id3"><span class="problematic" id="id4">*</span></a>&#64;localhost:7000/postgres”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 2,
“metadata”: {</p>
<blockquote>
<div><dl class="simple">
<dt>“vscode”: {</dt><dd><p>“languageId”: “sql”</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>},
“outputs”: [</p>
<blockquote>
<div><dl>
<dt>{</dt><dd><p>“name”: “stdout”,
“output_type”: “stream”,
“text”: [</p>
<blockquote>
<div><p>” * postgresql://gpadmin:<a href="#id5"><span class="problematic" id="id6">**</span></a><a href="#id7"><span class="problematic" id="id8">*</span></a>&#64;localhost:7000/postgresn”,
“Done.n”,
“Done.n”</p>
</div></blockquote>
<p>]</p>
</dd>
</dl>
<p>},
{</p>
<blockquote>
<div><dl class="simple">
<dt>“data”: {</dt><dd><p>“text/plain”: “[]”</p>
</dd>
</dl>
<p>},
“execution_count”: 2,
“metadata”: {},
“output_type”: “execute_result”</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>],
“source”: [</p>
<blockquote>
<div><p>“%%sqln”,
“– External Tablen”,
“DROP EXTERNAL TABLE IF EXISTS abalone_external;n”,
“CREATE EXTERNAL WEB TABLE abalone_external(n”,
”    sex textn”,
”    , length float8n”,
”    , diameter float8n”,
”    , height float8n”,
”    , whole_weight float8n”,
”    , shucked_weight float8n”,
”    , viscera_weight float8n”,
”    , shell_weight float8n”,
”    , rings integer – target variable to predictn”,
“) location(’<a class="reference external" href="http://archive.ics.uci.edu/ml/machine-learning-databases/abalone/abalone.data')n">http://archive.ics.uci.edu/ml/machine-learning-databases/abalone/abalone.data’)n</a>”,
“format ‘CSV’n”,
“(null as ‘?’);”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 3,
“metadata”: {},
“outputs”: [</p>
<blockquote>
<div><dl>
<dt>{</dt><dd><p>“name”: “stdout”,
“output_type”: “stream”,
“text”: [</p>
<blockquote>
<div><p>” * postgresql://gpadmin:<a href="#id9"><span class="problematic" id="id10">**</span></a><a href="#id11"><span class="problematic" id="id12">*</span></a>&#64;localhost:7000/postgresn”,
“Done.n”,
“4177 rows affected.n”</p>
</div></blockquote>
<p>]</p>
</dd>
</dl>
<p>},
{</p>
<blockquote>
<div><dl class="simple">
<dt>“data”: {</dt><dd><p>“text/plain”: “[]”</p>
</dd>
</dl>
<p>},
“execution_count”: 3,
“metadata”: {},
“output_type”: “execute_result”</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>],
“source”: [</p>
<blockquote>
<div><p>“%%sqln”,
“– Create abalone table from an external tablen”,
“DROP TABLE IF EXISTS abalone;n”,
“CREATE TABLE abalone AS (n”,
”    SELECT ROW_NUMBER() OVER() AS id, <a href="#id13"><span class="problematic" id="id14">*</span></a>n”,
”    FROM abalone_externaln”,
“) DISTRIBUTED BY (sex);”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“<strong>Train Test set split</strong>n”,
“n”,
“Before proceeding data exploration, let’s split our dataset to train and test set without using MADlib.n”,
“n”,
“Firstly, we fetch a random value between 0 and 1 to each row.n”,
“Then we create a percentile table that stores percentile values for each sex.n”,
“Finally, we join those 2 tables to obtain our training or test tables.n”,
“n”,
“But since Ordered-Set Aggregate Function is not yet supported with Beta version 1, we will skip this step with GreenplumPython and implement it with SQL.”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 4,
“metadata”: {},
“outputs”: [</p>
<blockquote>
<div><dl>
<dt>{</dt><dd><p>“name”: “stdout”,
“output_type”: “stream”,
“text”: [</p>
<blockquote>
<div><p>” * postgresql://gpadmin:<a href="#id15"><span class="problematic" id="id16">**</span></a><a href="#id17"><span class="problematic" id="id18">*</span></a>&#64;localhost:7000/postgresn”,
“4177 rows affected.n”,
“3 rows affected.n”,
“3 rows affected.n”,
“Done.n”,
“3343 rows affected.n”,
“Done.n”,
“837 rows affected.n”</p>
</div></blockquote>
<p>]</p>
</dd>
</dl>
<p>},
{</p>
<blockquote>
<div><dl class="simple">
<dt>“data”: {</dt><dd><p>“text/plain”: “[]”</p>
</dd>
</dl>
<p>},
“execution_count”: 4,
“metadata”: {},
“output_type”: “execute_result”</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>],
“source”: [</p>
<blockquote>
<div><p>“%%sqln”,
“CREATE TEMP TABLE temp_abalone_label ASn”,
”    (SELECT <em>, random() AS __samp_out_label FROM abalone);n”,
“n”,
“CREATE TEMP TABLE train_percentile_disc ASn”,
”    (SELECT sex, percentile_disc(0.8) within GROUP (ORDER BY __samp_out_label) AS __samp_out_labeln”,
”    FROM temp_abalone_label GROUP BY sex);n”,
“CREATE TEMP TABLE test_percentile_disc ASn”,
”    (SELECT sex, percentile_disc(0.2) within GROUP (ORDER BY __samp_out_label) AS __samp_out_labeln”,
”    FROM temp_abalone_label GROUP BY sex);n”,
“n”,
“DROP TABLE IF EXISTS abalone_train;n”,
“CREATE TABLE abalone_train ASn”,
”    (SELECT temp_abalone_label.</em>n”,
”        FROM temp_abalone_labeln”,
”        INNER JOIN train_percentile_discn”,
”        ON temp_abalone_label.__samp_out_label &lt;= train_percentile_disc.__samp_out_labeln”,
”        AND temp_abalone_label.sex = train_percentile_disc.sexn”,
”    );n”,
“DROP TABLE IF EXISTS abalone_test;n”,
“CREATE TABLE abalone_test ASn”,
”    (SELECT temp_abalone_label.*n”,
”        FROM temp_abalone_labeln”,
”        INNER JOIN test_percentile_discn”,
”        ON temp_abalone_label.__samp_out_label &lt;= test_percentile_disc.__samp_out_labeln”,
”        AND temp_abalone_label.sex = test_percentile_disc.sexn”,
”    )”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“Note that these features could be supported by GreenplumPython in future release.”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“# Import preparationn”,
“n”,
“We connect to Greenplum database named &quot;postgres&quot;”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 5,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“import greenplumpython as gp”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 6,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“db = gp.database(host=&quot;localhost&quot;, dbname=&quot;postgres&quot;)”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“# Data Explorationn”,
“n”,
“Get access to existed table &quot;abalone&quot;”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 7,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“abalone = db.table(&quot;abalone&quot;)”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“Take a look on table”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 8,
“metadata”: {},
“outputs”: [</p>
<blockquote>
<div><dl>
<dt>{</dt><dd><dl class="simple">
<dt>“data”: {</dt><dd><p>“text/plain”: “| id || sex || length || diameter || height || whole_weight || shucked_weight || viscera_weight || shell_weight || rings <a href="#id33"><span class="problematic" id="id34">|\n==========================================================================================================================\n|</span></a>  1 || M   ||  0.455 ||    0.365 ||  0.095 ||        0.514 ||         0.2245 ||          0.101 ||         0.15 ||    15 <a href="#id35"><span class="problematic" id="id36">|\n|</span></a>  2 || M   ||   0.35 ||    0.265 ||   0.09 ||       0.2255 ||         0.0995 ||         0.0485 ||         0.07 ||     7 <a href="#id37"><span class="problematic" id="id38">|\n|</span></a>  3 || F   ||   0.53 ||     0.42 ||  0.135 ||        0.677 ||         0.2565 ||         0.1415 ||         0.21 ||     9 <a href="#id39"><span class="problematic" id="id40">|\n|</span></a>  4 || M   ||   0.44 ||    0.365 ||  0.125 ||        0.516 ||         0.2155 ||          0.114 ||        0.155 ||    10 <a href="#id41"><span class="problematic" id="id42">|\n|</span></a>  5 || I   ||   0.33 ||    0.255 ||   0.08 ||        0.205 ||         0.0895 ||         0.0395 ||        0.055 ||     7 <a href="#id19"><span class="problematic" id="id20">|</span></a>”,
“text/html”: “&lt;table&gt;nt&lt;tr&gt;ntt&lt;th&gt;id&lt;/th&gt;ntt&lt;th&gt;sex&lt;/th&gt;ntt&lt;th&gt;length&lt;/th&gt;ntt&lt;th&gt;diameter&lt;/th&gt;ntt&lt;th&gt;height&lt;/th&gt;ntt&lt;th&gt;whole_weight&lt;/th&gt;ntt&lt;th&gt;shucked_weight&lt;/th&gt;ntt&lt;th&gt;viscera_weight&lt;/th&gt;ntt&lt;th&gt;shell_weight&lt;/th&gt;ntt&lt;th&gt;rings&lt;/th&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;1&lt;/td&gt;ntt&lt;td&gt;M&lt;/td&gt;ntt&lt;td&gt;0.455&lt;/td&gt;ntt&lt;td&gt;0.365&lt;/td&gt;ntt&lt;td&gt;0.095&lt;/td&gt;ntt&lt;td&gt;0.514&lt;/td&gt;ntt&lt;td&gt;0.2245&lt;/td&gt;ntt&lt;td&gt;0.101&lt;/td&gt;ntt&lt;td&gt;0.15&lt;/td&gt;ntt&lt;td&gt;15&lt;/td&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;2&lt;/td&gt;ntt&lt;td&gt;M&lt;/td&gt;ntt&lt;td&gt;0.35&lt;/td&gt;ntt&lt;td&gt;0.265&lt;/td&gt;ntt&lt;td&gt;0.09&lt;/td&gt;ntt&lt;td&gt;0.2255&lt;/td&gt;ntt&lt;td&gt;0.0995&lt;/td&gt;ntt&lt;td&gt;0.0485&lt;/td&gt;ntt&lt;td&gt;0.07&lt;/td&gt;ntt&lt;td&gt;7&lt;/td&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;3&lt;/td&gt;ntt&lt;td&gt;F&lt;/td&gt;ntt&lt;td&gt;0.53&lt;/td&gt;ntt&lt;td&gt;0.42&lt;/td&gt;ntt&lt;td&gt;0.135&lt;/td&gt;ntt&lt;td&gt;0.677&lt;/td&gt;ntt&lt;td&gt;0.2565&lt;/td&gt;ntt&lt;td&gt;0.1415&lt;/td&gt;ntt&lt;td&gt;0.21&lt;/td&gt;ntt&lt;td&gt;9&lt;/td&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;4&lt;/td&gt;ntt&lt;td&gt;M&lt;/td&gt;ntt&lt;td&gt;0.44&lt;/td&gt;ntt&lt;td&gt;0.365&lt;/td&gt;ntt&lt;td&gt;0.125&lt;/td&gt;ntt&lt;td&gt;0.516&lt;/td&gt;ntt&lt;td&gt;0.2155&lt;/td&gt;ntt&lt;td&gt;0.114&lt;/td&gt;ntt&lt;td&gt;0.155&lt;/td&gt;ntt&lt;td&gt;10&lt;/td&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;5&lt;/td&gt;ntt&lt;td&gt;I&lt;/td&gt;ntt&lt;td&gt;0.33&lt;/td&gt;ntt&lt;td&gt;0.255&lt;/td&gt;ntt&lt;td&gt;0.08&lt;/td&gt;ntt&lt;td&gt;0.205&lt;/td&gt;ntt&lt;td&gt;0.0895&lt;/td&gt;ntt&lt;td&gt;0.0395&lt;/td&gt;ntt&lt;td&gt;0.055&lt;/td&gt;ntt&lt;td&gt;7&lt;/td&gt;nt&lt;/tr&gt;n&lt;/table&gt;”</p>
</dd>
</dl>
<p>},
“execution_count”: 8,
“metadata”: {},
“output_type”: “execute_result”</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>],
“source”: [</p>
<blockquote>
<div><p>“# SELECT * FROM abalone ORDER BY id LIMIT 5;n”,
“n”,
“abalone.order_by(&quot;id&quot;)[:5]”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“Observe the distribution of data on different segments”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 9,
“metadata”: {},
“outputs”: [</p>
<blockquote>
<div><dl>
<dt>{</dt><dd><dl class="simple">
<dt>“data”: {</dt><dd><p>“text/plain”: “| count || gp_segment_id <a href="#id43"><span class="problematic" id="id44">|\n==========================\n|</span></a>  2870 ||             1 <a href="#id45"><span class="problematic" id="id46">|\n|</span></a>  1307 ||             2 <a href="#id21"><span class="problematic" id="id22">|</span></a>”,
“text/html”: “&lt;table&gt;nt&lt;tr&gt;ntt&lt;th&gt;count&lt;/th&gt;ntt&lt;th&gt;gp_segment_id&lt;/th&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;2870&lt;/td&gt;ntt&lt;td&gt;1&lt;/td&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;1307&lt;/td&gt;ntt&lt;td&gt;2&lt;/td&gt;nt&lt;/tr&gt;n&lt;/table&gt;”</p>
</dd>
</dl>
<p>},
“execution_count”: 9,
“metadata”: {},
“output_type”: “execute_result”</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>],
“source”: [</p>
<blockquote>
<div><p>“# SELECT gp_segment_id, COUNT(*)n”,
“# FROM abalonen”,
“# GROUP BY 1n”,
“# ORDER BY gp_segment_id;n”,
“n”,
“import greenplumpython.builtin.function as Fn”,
“n”,
“abalone.group_by(&quot;gp_segment_id&quot;).apply(lambda _: F.count())”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“Since we already have table &quot;abalone_train&quot; ad &quot;abalone_test&quot; in the database, we can get access to them.”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 10,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“abalone_train = db.table(&quot;abalone_train&quot;)n”,
“abalone_test = db.table(&quot;abalone_test&quot;)”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“# Execute the OLS Linear Regression Function by ‘sex’n”,
“n”,
“## Training Processn”,
“n”,
“<strong>Creation of training function</strong>”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 11,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“from typing import Listn”,
“n”,
“# CREATE TYPE linreg_type AS (n”,
“#    col_nm text[]n”,
“#    , coef float8[]n”,
“#    , intercept float8n”,
“#    , serialized_linreg_model bytean”,
“#    , created_dt textn”,
“# );n”,
“n”,
“n”,
“class LinregType:n”,
”    col_nm: List[str]n”,
”    coef: List[float]n”,
”    intercept: floatn”,
”    serialized_linreg_model: bytesn”,
”    created_dt: strn”,
“n”,
“n”,
“# – Create functionn”,
“# – Need to specify the return type -&gt; API will create the corresponding type in Greenplum to return a rown”,
“# – Will add argument to change language extensions, currently plpython3u by defaultn”,
“n”,
“n”,
“&#64;gp.create_array_functionn”,
“def linreg_func(length: List[float], shucked_weight: List[float], rings: List[int]) -&gt; LinregType:n”,
”    from sklearn.linear_model import LinearRegressionn”,
”    import numpy as npn”,
“n”,
”    X = np.array([length, shucked_weight]).Tn”,
”    y = np.array([rings]).Tn”,
“n”,
”    # OLS linear regression with length, shucked_weightn”,
”    linreg_fit = LinearRegression().fit(X, y)n”,
”    linreg_coef = <a href="#id87"><span class="problematic" id="id88">linreg_fit.coef_</span></a>n”,
”    linreg_intercept = <a href="#id89"><span class="problematic" id="id90">linreg_fit.intercept_</span></a>n”,
“n”,
”    # Serialization of the fitted modeln”,
”    import sixn”,
”    import datetimen”,
“n”,
”    pickle = six.moves.cPicklen”,
”    serialized_linreg_model = pickle.dumps(linreg_fit, protocol=3)n”,
“n”,
”    return {n”,
”        &quot;col_nm&quot;: [&quot;length&quot;, &quot;shucked_weight&quot;],n”,
”        &quot;coef&quot;: linreg_coef[0],n”,
”        &quot;intercept&quot;: linreg_intercept[0],n”,
”        &quot;serialized_linreg_model&quot;: serialized_linreg_model,n”,
”        &quot;created_dt&quot;: str(datetime.datetime.now()),n”,
”    }”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“<strong>Apply &quot;linreg_fitted&quot; function to our train set</strong>”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 12,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“# DROP TABLE IF EXISTS plc_linreg_fitted;n”,
“# CREATE TABLE plc_linreg_fitted AS (n”,
“#    SELECTn”,
“#        a.sexn”,
“#        , (plc_linreg_func(n”,
“#            a.length_aggn”,
“#            , a.shucked_weight_aggn”,
“#            , a.rings_agg)n”,
“#        ).*n”,
“#    FROM (n”,
“#        SELECTn”,
“#            sexn”,
“#            , ARRAY_AGG(length) AS length_aggn”,
“#            , ARRAY_AGG(shucked_weight) AS shucked_weight_aggn”,
“#            , ARRAY_AGG(rings) AS rings_aggn”,
“#        FROM abalone_splitn”,
“#        WHERE split = 1n”,
“#        GROUP BY sexn”,
“#    ) an”,
“# ) DISTRIBUTED BY (sex);n”,
“n”,
“linreg_fitted = (n”,
”    abalone_train.group_by(&quot;sex&quot;)n”,
”    .apply(lambda t: linreg_func(t[&quot;length&quot;], t[&quot;shucked_weight&quot;], t[&quot;rings&quot;]), expand=True)n”,
“)”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“<strong>Take a look at models built</strong>”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 13,
“outputs”: [</p>
<blockquote>
<div><dl class="simple">
<dt>{</dt><dd><p>“data”: {</p>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
</dd>
</dl>
</dd>
<dt>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</dt><dd><p>“text/plain”: “| sex || col_nm                       || coef                                     || intercept           || created_dt                 <a href="#id47"><span class="problematic" id="id48">|\n========================================================================================================================================\n|</span></a> F   || [‘length’, ‘shucked_weight’] || [25.064476469020896, -7.971276893342533] || 0.14402961193298403 || 2022-10-28 10:27:49.073549 <a href="#id49"><span class="problematic" id="id50">|\n|</span></a> M   || [‘length’, ‘shucked_weight’] || [23.474589477353632, -6.486874929907139] ||   0.400537367442098 || 2022-10-28 10:27:49.073452 <a href="#id51"><span class="problematic" id="id52">|\n|</span></a> I   || [‘length’, ‘shucked_weight’] || [15.60472937590157, 0.170324586295711]   ||  1.1456532205072136 || 2022-10-28 10:27:49.079175 <a href="#id23"><span class="problematic" id="id24">|</span></a>”,
“text/html”: “&lt;table&gt;nt&lt;tr&gt;ntt&lt;th&gt;sex&lt;/th&gt;ntt&lt;th&gt;col_nm&lt;/th&gt;ntt&lt;th&gt;coef&lt;/th&gt;ntt&lt;th&gt;intercept&lt;/th&gt;ntt&lt;th&gt;created_dt&lt;/th&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;F&lt;/td&gt;ntt&lt;td&gt;[‘length’, ‘shucked_weight’]&lt;/td&gt;ntt&lt;td&gt;[25.064476469020896, -7.971276893342533]&lt;/td&gt;ntt&lt;td&gt;0.14402961193298403&lt;/td&gt;ntt&lt;td&gt;2022-10-28 10:27:49.073549&lt;/td&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;M&lt;/td&gt;ntt&lt;td&gt;[‘length’, ‘shucked_weight’]&lt;/td&gt;ntt&lt;td&gt;[23.474589477353632, -6.486874929907139]&lt;/td&gt;ntt&lt;td&gt;0.400537367442098&lt;/td&gt;ntt&lt;td&gt;2022-10-28 10:27:49.073452&lt;/td&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;I&lt;/td&gt;ntt&lt;td&gt;[‘length’, ‘shucked_weight’]&lt;/td&gt;ntt&lt;td&gt;[15.60472937590157, 0.170324586295711]&lt;/td&gt;ntt&lt;td&gt;1.1456532205072136&lt;/td&gt;ntt&lt;td&gt;2022-10-28 10:27:49.079175&lt;/td&gt;nt&lt;/tr&gt;n&lt;/table&gt;”</p>
</dd>
</dl>
<dl>
<dt>&gt;&gt;&gt;&gt;&gt;&gt;&gt; cf22354 (Resupport <cite>apply()</cite> function (#110))</dt><dd><blockquote>
<div><blockquote>
<div><blockquote>
<div><p>},
“execution_count”: 13,
“metadata”: {},
“output_type”: “execute_result”</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>],
“source”: [</p>
<blockquote>
<div><p>“linreg_fitted[[&quot;sex&quot;, &quot;col_nm&quot;, &quot;coef&quot;, &quot;intercept&quot;, &quot;created_dt&quot;]]”</p>
</div></blockquote>
<p>],
“metadata”: {</p>
<blockquote>
<div><p>“collapsed”: false</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“<strong>Get summary of parameter’s coefficient for three sex</strong>”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {</p>
<blockquote>
<div><p>“collapsed”: false</p>
</div></blockquote>
<p>},
“source”: [</p>
<blockquote>
<div><p>“n”,
“- Using ARRAY_APPEND”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 14,
“metadata”: {</p>
<blockquote>
<div><p>“collapsed”: false</p>
</div></blockquote>
<p>},
“outputs”: [</p>
<blockquote>
<div><dl class="simple">
<dt>{</dt><dd><p>“data”: {</p>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
</dd>
<dt>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</dt><dd><p>“text/plain”: “| sex || col_nm2        || coef2               <a href="#id53"><span class="problematic" id="id54">|\n================================================\n|</span></a> F   || length         ||  25.064476469020896 <a href="#id55"><span class="problematic" id="id56">|\n|</span></a> F   || shucked_weight ||  -7.971276893342533 <a href="#id57"><span class="problematic" id="id58">|\n|</span></a> F   || intercept      || 0.14402961193298403 <a href="#id59"><span class="problematic" id="id60">|\n|</span></a> M   || length         ||  23.474589477353632 <a href="#id61"><span class="problematic" id="id62">|\n|</span></a> M   || shucked_weight ||  -6.486874929907139 <a href="#id63"><span class="problematic" id="id64">|\n|</span></a> M   || intercept      ||   0.400537367442098 <a href="#id65"><span class="problematic" id="id66">|\n|</span></a> I   || length         ||   15.60472937590157 <a href="#id67"><span class="problematic" id="id68">|\n|</span></a> I   || shucked_weight ||   0.170324586295711 <a href="#id69"><span class="problematic" id="id70">|\n|</span></a> I   || intercept      ||  1.1456532205072136 <a href="#id25"><span class="problematic" id="id26">|</span></a>”,
“text/html”: “&lt;table&gt;nt&lt;tr&gt;ntt&lt;th&gt;sex&lt;/th&gt;ntt&lt;th&gt;col_nm2&lt;/th&gt;ntt&lt;th&gt;coef2&lt;/th&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;F&lt;/td&gt;ntt&lt;td&gt;length&lt;/td&gt;ntt&lt;td&gt;25.064476469020896&lt;/td&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;F&lt;/td&gt;ntt&lt;td&gt;shucked_weight&lt;/td&gt;ntt&lt;td&gt;-7.971276893342533&lt;/td&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;F&lt;/td&gt;ntt&lt;td&gt;intercept&lt;/td&gt;ntt&lt;td&gt;0.14402961193298403&lt;/td&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;M&lt;/td&gt;ntt&lt;td&gt;length&lt;/td&gt;ntt&lt;td&gt;23.474589477353632&lt;/td&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;M&lt;/td&gt;ntt&lt;td&gt;shucked_weight&lt;/td&gt;ntt&lt;td&gt;-6.486874929907139&lt;/td&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;M&lt;/td&gt;ntt&lt;td&gt;intercept&lt;/td&gt;ntt&lt;td&gt;0.400537367442098&lt;/td&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;I&lt;/td&gt;ntt&lt;td&gt;length&lt;/td&gt;ntt&lt;td&gt;15.60472937590157&lt;/td&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;I&lt;/td&gt;ntt&lt;td&gt;shucked_weight&lt;/td&gt;ntt&lt;td&gt;0.170324586295711&lt;/td&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;I&lt;/td&gt;ntt&lt;td&gt;intercept&lt;/td&gt;ntt&lt;td&gt;1.1456532205072136&lt;/td&gt;nt&lt;/tr&gt;n&lt;/table&gt;”</p>
</dd>
</dl>
<dl>
<dt>&gt;&gt;&gt;&gt;&gt;&gt;&gt; cf22354 (Resupport <cite>apply()</cite> function (#110))</dt><dd><blockquote>
<div><blockquote>
<div><blockquote>
<div><p>},
“execution_count”: 14,
“metadata”: {},
“output_type”: “execute_result”</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>],
“source”: [</p>
<blockquote>
<div><p>“# SELECTn”,
“#   sex,n”,
“#   UNNEST(ARRAY_APPEND(col_nm, ‘intercept’)) AS col_nm2,n”,
“#   UNNEST(ARRAY_APPEND(coef, intercept)) AS coef2n”,
“# from linreg_fitted;n”,
“n”,
“unnest = gp.function(&quot;unnest&quot;)n”,
“array_append = gp.function(&quot;array_append&quot;)n”,
“n”,
“linreg_fitted.assign(n”,
”    col_nm2=lambda t: unnest(array_append(t[&quot;col_nm&quot;], &quot;intercept&quot;)),n”,
”    coef2=lambda t: unnest(array_append(t[&quot;coef&quot;], t[&quot;intercept&quot;])),n”,
“)[[&quot;sex&quot;, &quot;col_nm2&quot;, &quot;coef2&quot;]]”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“## Predictionn”,
“n”,
“<strong>Creation of prediction function</strong>”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 15,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“&#64;gp.create_functionn”,
“def linreg_pred_func(serialized_model: bytes, length: float, shucked_weight: float) -&gt; float:n”,
”    # Deserialize the serialized modeln”,
”    import sixn”,
“n”,
”    pickle = six.moves.cPicklen”,
”    model = pickle.loads(serialized_model)n”,
“n”,
”    features = [length, shucked_weight]n”,
“n”,
”    # Predict the target variablen”,
”    y_pred = model.predict([features])n”,
“n”,
”    return y_pred[0][0]”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {</p>
<blockquote>
<div><p>“collapsed”: false</p>
</div></blockquote>
<p>},
“source”: [</p>
<blockquote>
<div><p>“<strong>Join model table and test set table</strong>”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 16,
“metadata”: {</p>
<blockquote>
<div><p>“collapsed”: false</p>
</div></blockquote>
<p>},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“linreg_test_fit = linreg_fitted.inner_join(n”,
”    abalone_test,n”,
”    cond=lambda t1, t2: t1[&quot;sex&quot;] == t2[&quot;sex&quot;],n”,
”    self_columns=[&quot;col_nm&quot;, &quot;coef&quot;, &quot;intercept&quot;, &quot;serialized_linreg_model&quot;, &quot;created_dt&quot;],n”,
”    other_columns=[&quot;<a href="#id27"><span class="problematic" id="id28">*</span></a>&quot;],n”,
“)”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {</p>
<blockquote>
<div><p>“collapsed”: false</p>
</div></blockquote>
<p>},
“source”: [</p>
<blockquote>
<div><p>“<strong>Predict test set</strong>”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 17,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“# CREATE TABLE plc_linreg_pred_dot AS (n”,
“#    SELECTn”,
“#        test.idn”,
“#        , test.sexn”,
“#        , test.ringsn”,
“#        , plc_linreg_pred_dot_func(n”,
“#            model.coefn”,
“#            , model.interceptn”,
“#            , ARRAY[length, shucked_weight]n”,
“#        ) AS y_predn”,
“#    FROMn”,
“#        (SELECT * FROM abalone_split WHERE split=0) AS testn”,
“#        , plc_linreg_fitted AS modeln”,
“#    WHERE test.sex = model.sexn”,
“# ) DISTRIBUTED BY (sex);n”,
“n”,
“n”,
“linreg_pred = linreg_test_fit.assign(n”,
”    rings_pred=lambda t:n”,
”        linreg_pred_func(n”,
”            t[&quot;serialized_linreg_model&quot;],n”,
”            t[&quot;length&quot;],n”,
”            t[&quot;shucked_weight&quot;],n”,
”        ),n”,
“)[[&quot;id&quot;, &quot;sex&quot;, &quot;rings&quot;, &quot;rings_pred&quot;]]”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 18,
“metadata”: {</p>
<blockquote>
<div><p>“collapsed”: false</p>
</div></blockquote>
<p>},
“outputs”: [</p>
<blockquote>
<div><dl class="simple">
<dt>{</dt><dd><p>“data”: {</p>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
</dd>
<dt>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</dt><dd><p>“text/plain”: “| id  || sex || rings || rings_pred         <a href="#id71"><span class="problematic" id="id72">|\n=============================================\n|</span></a>  51 || I   ||     8 ||  9.300734909807558 <a href="#id73"><span class="problematic" id="id74">|\n|</span></a> 135 || I   ||     7 ||  5.287719488572958 <a href="#id75"><span class="problematic" id="id76">|\n|</span></a> 148 || I   ||     9 ||  5.523834324247031 <a href="#id77"><span class="problematic" id="id78">|\n|</span></a> 149 || I   ||     5 ||  3.878269269446093 <a href="#id79"><span class="problematic" id="id80">|\n|</span></a> 234 || I   ||     7 || 5.4452145413154875 <a href="#id29"><span class="problematic" id="id30">|</span></a>”,
“text/html”: “&lt;table&gt;nt&lt;tr&gt;ntt&lt;th&gt;id&lt;/th&gt;ntt&lt;th&gt;sex&lt;/th&gt;ntt&lt;th&gt;rings&lt;/th&gt;ntt&lt;th&gt;rings_pred&lt;/th&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;51&lt;/td&gt;ntt&lt;td&gt;I&lt;/td&gt;ntt&lt;td&gt;8&lt;/td&gt;ntt&lt;td&gt;9.300734909807558&lt;/td&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;135&lt;/td&gt;ntt&lt;td&gt;I&lt;/td&gt;ntt&lt;td&gt;7&lt;/td&gt;ntt&lt;td&gt;5.287719488572958&lt;/td&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;148&lt;/td&gt;ntt&lt;td&gt;I&lt;/td&gt;ntt&lt;td&gt;9&lt;/td&gt;ntt&lt;td&gt;5.523834324247031&lt;/td&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;149&lt;/td&gt;ntt&lt;td&gt;I&lt;/td&gt;ntt&lt;td&gt;5&lt;/td&gt;ntt&lt;td&gt;3.878269269446093&lt;/td&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;234&lt;/td&gt;ntt&lt;td&gt;I&lt;/td&gt;ntt&lt;td&gt;7&lt;/td&gt;ntt&lt;td&gt;5.4452145413154875&lt;/td&gt;nt&lt;/tr&gt;n&lt;/table&gt;”</p>
</dd>
</dl>
<dl>
<dt>&gt;&gt;&gt;&gt;&gt;&gt;&gt; cf22354 (Resupport <cite>apply()</cite> function (#110))</dt><dd><blockquote>
<div><blockquote>
<div><blockquote>
<div><p>},
“execution_count”: 18,
“metadata”: {},
“output_type”: “execute_result”</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>],
“source”: [</p>
<blockquote>
<div><p>“# SELECT * FROM plc_linreg_pred WHERE sex=’I’ ORDER BY id LIMIT 5;n”,
“n”,
“linreg_pred[lambda t: t[&quot;sex&quot;] == &quot;I&quot;].order_by(&quot;id&quot;)[:5]”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {</p>
<blockquote>
<div><p>“collapsed”: false</p>
</div></blockquote>
<p>},
“source”: [</p>
<blockquote>
<div><p>“## Evaluation of modeln”,
“n”,
“<strong>Creation of evaluation return type</strong>”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 19,
“metadata”: {</p>
<blockquote>
<div><p>“collapsed”: false</p>
</div></blockquote>
<p>},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“# CREATE TYPE plc_linreg_eval_type AS (n”,
“#    mae float8n”,
“#    , mape float8n”,
“#    , mse float8n”,
“#    , r2_score float8n”,
“# );n”,
“n”,
“n”,
“class linreg_eval_type:n”,
”    mae: floatn”,
”    mape: floatn”,
”    mse: floatn”,
”    r2_score: float”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {</p>
<blockquote>
<div><p>“collapsed”: false</p>
</div></blockquote>
<p>},
“source”: [</p>
<blockquote>
<div><p>“<strong>Creation of evaluation function</strong>”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 20,
“metadata”: {</p>
<blockquote>
<div><p>“collapsed”: false</p>
</div></blockquote>
<p>},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“&#64;gp.create_array_functionn”,
“def linreg_eval(y_actual: List[float], y_pred: List[float]) -&gt; linreg_eval_type:n”,
”    from sklearn.metrics import mean_absolute_error, mean_squared_error, r2_scoren”,
”    import numpy as npn”,
“n”,
”    mae = mean_absolute_error(y_actual, y_pred)n”,
”    mse = mean_squared_error(y_actual, y_pred)n”,
”    r2_score = r2_score(y_actual, y_pred)n”,
“n”,
”    y_pred_f = np.array(y_pred, dtype=float)n”,
”    mape = 100 * sum(abs(y_actual - y_pred_f) / y_actual) / len(y_actual)n”,
“n”,
”    # eval_score = [mae, mape, mse, r2_score]n”,
“n”,
”    return {&quot;mae&quot;: mae, &quot;mape&quot;: mape, &quot;mse&quot;: mse, &quot;r2_score&quot;: r2_score}”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {</p>
<blockquote>
<div><p>“collapsed”: false</p>
</div></blockquote>
<p>},
“source”: [</p>
<blockquote>
<div><p>“Evaluate our model”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 21,
“metadata”: {</p>
<blockquote>
<div><p>“collapsed”: false</p>
</div></blockquote>
<p>},
“outputs”: [</p>
<blockquote>
<div><dl class="simple">
<dt>{</dt><dd><p>“data”: {</p>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
</dd>
<dt>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</dt><dd><p>“text/plain”: “| sex || mae                || mape               || mse               || r2_score            <a href="#id81"><span class="problematic" id="id82">|\n===============================================================================================\n|</span></a> F   || 2.1684036058174128 ||  19.81216897545126 || 7.876612765316872 || 0.08913495016372974 <a href="#id83"><span class="problematic" id="id84">|\n|</span></a> M   || 2.0103204067022693 || 19.164943108519978 || 7.788626230610322 ||  0.2140201106290267 <a href="#id85"><span class="problematic" id="id86">|\n|</span></a> I   || 1.1442499649201459 || 14.423205839401918 || 2.665751060618734 ||  0.5163806536192345 <a href="#id31"><span class="problematic" id="id32">|</span></a>”,
“text/html”: “&lt;table&gt;nt&lt;tr&gt;ntt&lt;th&gt;sex&lt;/th&gt;ntt&lt;th&gt;mae&lt;/th&gt;ntt&lt;th&gt;mape&lt;/th&gt;ntt&lt;th&gt;mse&lt;/th&gt;ntt&lt;th&gt;r2_score&lt;/th&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;F&lt;/td&gt;ntt&lt;td&gt;2.1684036058174128&lt;/td&gt;ntt&lt;td&gt;19.81216897545126&lt;/td&gt;ntt&lt;td&gt;7.876612765316872&lt;/td&gt;ntt&lt;td&gt;0.08913495016372974&lt;/td&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;M&lt;/td&gt;ntt&lt;td&gt;2.0103204067022693&lt;/td&gt;ntt&lt;td&gt;19.164943108519978&lt;/td&gt;ntt&lt;td&gt;7.788626230610322&lt;/td&gt;ntt&lt;td&gt;0.2140201106290267&lt;/td&gt;nt&lt;/tr&gt;nt&lt;tr&gt;ntt&lt;td&gt;I&lt;/td&gt;ntt&lt;td&gt;1.1442499649201459&lt;/td&gt;ntt&lt;td&gt;14.423205839401918&lt;/td&gt;ntt&lt;td&gt;2.665751060618734&lt;/td&gt;ntt&lt;td&gt;0.5163806536192345&lt;/td&gt;nt&lt;/tr&gt;n&lt;/table&gt;”</p>
</dd>
</dl>
<dl>
<dt>&gt;&gt;&gt;&gt;&gt;&gt;&gt; cf22354 (Resupport <cite>apply()</cite> function (#110))</dt><dd><blockquote>
<div><blockquote>
<div><blockquote>
<div><blockquote>
<div><p>},
“execution_count”: 21,
“metadata”: {},
“output_type”: “execute_result”</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>],
“source”: [</p>
<blockquote>
<div><p>“# SELECTn”,
“#    sexn”,
“#    , (linreg_eval(rings_agg, y_pred_agg)).*n”,
“# FROM (n”,
“#    SELECTn”,
“#        sexn”,
“#        , ARRAY_AGG(rings) AS rings_aggn”,
“#        , ARRAY_AGG(y_pred) AS y_pred_aggn”,
“#    FROM plc_linreg_predn”,
“#    GROUP BY sexn”,
“# ) an”,
“n”,
“n”,
“linreg_pred.group_by(&quot;sex&quot;).apply(lambda t: linreg_eval(t[&quot;rings&quot;], t[&quot;rings_pred&quot;]), expand=True)”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: 21,
“outputs”: [],
“source”: [],
“metadata”: {</p>
<blockquote>
<div><p>“collapsed”: false</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>],
“metadata”: {</p>
<blockquote>
<div><dl class="simple">
<dt>“jupytext”: {</dt><dd><p>“formats”: “ipynb,md”</p>
</dd>
</dl>
<p>},
“kernelspec”: {</p>
<blockquote>
<div><p>“display_name”: “Python 3.6.8 64-bit”,
“language”: “python”,
“name”: “python3”</p>
</div></blockquote>
<p>},
“language_info”: {</p>
<blockquote>
<div><dl class="simple">
<dt>“codemirror_mode”: {</dt><dd><p>“name”: “ipython”,
“version”: 3</p>
</dd>
</dl>
<p>},
“file_extension”: “.py”,
“mimetype”: “text/x-python”,
“name”: “python”,
“nbconvert_exporter”: “python”,
“pygments_lexer”: “ipython3”,
“version”: “3.6.8”</p>
</div></blockquote>
<p>},
“vscode”: {</p>
<blockquote>
<div><dl class="simple">
<dt>“interpreter”: {</dt><dd><p>“hash”: “31f2aee4e71d21fbe5cf8b01ff0e069b9275f58929596ceb00d14d90e3e16cd6”</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
“nbformat”: 4,
“nbformat_minor”: 1</p>
</dd>
</dl>
<p>}</p>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../examples.html" class="btn btn-neutral float-left" title="Data Science on Python with GreenplumPython" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, VMware.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>